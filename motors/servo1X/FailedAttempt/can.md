# 电机通讯协议

## 第5章 CAN通讯

### 5.1 SDO格式

#### SDO读取数据格式

| 主机发送读取命令格式 | 报文ID | DLC | DATA0 | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 |
|----------------------|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
|                      | 0x600+站号 | 8   | 0x40  | 0x63  | 0x60  | 0x00  | 0x00  | 0x00  | 0x00  | 0x00  |
|                      |          |     | 读命令 | 对象索引 | 对象索引 | 子索引 |       |       |       |       |

| 从机应答命令格式 | 报文ID | DLC | DATA0 | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 |
|-------------------|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
|                   | 0x580+站号 | 8   | 0x60  | 0x63  | 0x60  | 0x00  | 0x00  | 0x00  | 0x00  | 0x00  |
|                   |          |     | 命令  | 对象索引 | 对象索引 | 子索引 | 回复数据 | 回复数据 | 回复数据 | 回复数据 |

#### SDO写入数据格式

| 主机发送写命令格式 | 报文ID | DLC | DATA0 | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 |
|--------------------|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
|                    | 0x600+站号 | 8   | 0x20  | 0x40  | 0x60  | 0x00  | 0x00  | 0x00  | 0x00  | 0x00  |
|                    |          |     | 写命令 | 对象索引 | 对象索引 | 子索引 | 写数据 | 写数据 | 写数据 | 写数据 |

| 从机应答命令格式 | 报文ID | DLC | DATA0 | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 |
|-------------------|--------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
|                   | 0x580+站号 | 8   | 0x60  | 0x40  | 0x60  | 0x00  | 0x00  | 0x00  | 0x00  | 0x00  |
|                   |          |     | 命令  | 对象索引 | 对象索引 | 子索引 | 回复数据 | 回复数据 | 回复数据 | 回复数据 |

### 5.2 默认TPDO和RPDO配置

#### TPDO格式

默认会5ms周期性的上传PDO报文。

| COBID | DLC | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 | DATA8 |
|-------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
| 0x181 | 8   | 实际速度（高位在前） | 实际速度（高位在前） | 实际速度（高位在前） | 实际速度（高位在前） | 实际位置（高位在前） | 实际位置（高位在前） | 实际位置（高位在前） | 实际位置（高位在前） |

#### RPDO格式

| COBID | DLC | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 | DATA8 |
|-------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
| 0x201 | 8   | 工作模式（高位在前） | 工作模式（高位在前） | 控制字（高位在前） | 控制字（高位在前） | 目标位置（高位在前） | 目标位置（高位在前） | 目标位置（高位在前） | 目标位置（高位在前） |
|       |     | 1：带加减速的位置模式<br>7:插补位置模式 | 同DATA1 | 0x0006：松轴就绪<br>0x000F：锁轴使能<br>0x0086：清错 | 同DATA3 |       |       |       |       |

| COBID | DLC | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 | DATA8 |
|-------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
| 0x301 | 8   | 工作模式（高位在前） | 工作模式（高位在前） | 控制字（高位在前） | 控制字（高位在前） | 目标速度（高位在前） | 目标速度（高位在前） | 目标速度（高位在前） | 目标速度（高位在前） |
|       |     | 3：带加减速速度模式（带位置环）<br>22：带加减速的速度模式（不带位置环）<br>2：立即速度模式、插补速度模式 | 同DATA1 | 0x0006：松轴就绪<br>0x000F：锁轴使能<br>0x0086：清错 | 同DATA3 |       |       |       |       |

| COBID | DLC | DATA1 | DATA2 | DATA3 | DATA4 | DATA5 | DATA6 | DATA7 | DATA8 |
|-------|-----|-------|-------|-------|-------|-------|-------|-------|-------|
| 0x401 | 8   | 工作模式（高位在前） | 工作模式（高位在前） | 控制字（高位在前） | 控制字（高位在前） | 目标电流（高位在前） | 目标电流（高位在前） | 目标电流（高位在前） | 目标电流（高位在前） |
|       |     | 4：力矩模式 | 同DATA1 | 0x0006：松轴就绪<br>0x000F：锁轴使能<br>0x0086：清错 | 同DATA3 |       |       |       |       |

### 5.3 数据对象地址列表

| 地址 | 字节数 | 描述 | 备注 | 权限 |
|------|--------|------|------|------|
| 0x1010 01 | 2字节 | 存储参数 | 0：空闲<br>1：存储参数<br>2：初始化控制参数<br>3：初始化电机参数<br>4：初始化所有参数并保存<br>5：重启 | 读写 |
| 0x2300 00 | 4字节 | 错误状态 | Bit1：电流传感器错误<br>Bit3：编码器错误<br>Bit4：霍尔信号错误<br>Bit5：励磁错误<br>Bit6：跟随超差错误<br>Bit8：低压错误<br>Bit9：高压错误<br>Bit10：过温错误<br>Bit11：过流错误<br>Bit12：过载错误 | 只读 |
| 0x2301 00 | 2字节 | 设备温度 | 单位是0.1℃ | 只读 |
| 0x6040 00 | 2字节 | 控制字 | 6：松轴<br>F：锁轴<br>86：清错 | 读写 |
| 0x6041 00 |      | 状态字 |      | 只读 |
| 0x6060 00 | 2字节 | 工作模式 | 0：开环拖动（内部使用）<br>1：带轨迹位置模式<br>2：速度模式<br>3：带轨迹速度模式<br>4：力矩模式<br>7：位置模式 | 读写/存储 |
| 0x6061 00 | 2字节 | 工作模式（只读） | 目标位置，单位count | 只读 |
| 0x6063 00 | 4字节 | 实际位置 | 电机实际位置，单位count | 只读 |
| 0x6064 00 | 4字节 | 实际位置 | 电机实际位置，单位count | 只读 |
| 0x606C 00 | 4字节 | 实际速度 | 电机实时速度，单位0.001转/秒 | 只读 |
| 0x6078 00 | 4字节 | 实际电流 | 驱动器输出的q轴电流，单位是0.001A | 只读 |
| 0x6079 00 | 2字节 | 母线电压 | 直流总线电压，即输入电压，单位是0.1V | 只读 |
| 0x607A 00 | 4字节 | 目标位置 | 目标位置，单位count | 读写/存储 |
| 0x607C 00 | 4字节 | 原点偏移 | 单位count | 读写/存储 |
| 0x6081 00 | 4字节 | 规划轨迹速度 | 轨迹模式运行时的最大速度，单位0.001转/秒 | 读写/存储 |
| 0x6083 00 | 4字节 | 轨迹加速度 | 轨迹模式运行时的加速度，单位0.001转/秒/秒 | 读写/存储 |
| 0x6084 00 | 4字节 | 轨迹减速度 | 轨迹模式运行时的减速度，单位0.001转/秒/秒 | 读写/存储 |
| 0x6098 00 | 2字节 | 原点模式 | 0：把当前位置设置为0点<br>1:多圈位置清零 | 读写/存储 |
| 0x6099 00 | 4字节 | 原点速度 | 找原点时的运行速度，单位0.001转/秒 | 读写/存储 |
| 0x609A 00 | 4字节 | 原点加速度 | 找原点时的加速度，单位0.001转/秒/秒 | 读写/存储 |
| 0x60FF 00 | 4字节 | 目标速度 | 目标速度，单位0.001转/秒 | 读写/存储 |
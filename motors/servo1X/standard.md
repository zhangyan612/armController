# 通讯控制

## Modbus通讯

### Modbus读取数据格式（功能码0x03）

| 字段 | 描述 |
| --- | --- |
| 设备站号 | 例如：0x01 |
| 功能码 | 0x03 |
| 第一个寄存器的高位地址 | 例如：0x00 |
| 第一个寄存器的低位地址 | 例如：0x2A |
| 寄存器个数高位 | 例如：0x00 |
| 寄存器个数低位 | 例如：0x02 |
| CRC高位 | 例如：0xE5 |
| CRC低位 | 例如：0xC3 |

**从机应答命令格式**

| 字段 | 描述 |
| --- | --- |
| 设备站号 | 例如：0x01 |
| 功能码 | 0x03 |
| 数据长度 | 例如：0x02 |
| 第一个数据高字节 | 例如：0x00 |
| ... | ... |
| 第一个数据低字节 | 例如：0x01 |
| CRC高位 | 例如：0xB3 |
| CRC低位 | 例如：0xF3 |

### Modbus写单个寄存器数据格式（功能码0x06）

| 字段 | 描述 |
| --- | --- |
| 设备站号 | 例如：0x01 |
| 功能码 | 0x06 |
| 第一个寄存器的高位地址 | 例如：0x00 |
| 第一个寄存器的低位地址 | 例如：0x2A |
| 写数据高位 | 例如：0x00 |
| 写数据低位 | 例如：0x02 |
| CRC高位 | 例如：0xC8 |
| CRC低位 | 例如：0x07 |

**从机应答命令格式**

与主机发送写数据命令格式相同。

### Modbus写多个寄存器数据格式（功能码0x10）

| 字段 | 描述 |
| --- | --- |
| 设备站号 | 例如：0x01 |
| 功能码 | 0x10 |
| 第一个寄存器的高位地址 | 例如：0x00 |
| 第一个寄存器的低位地址 | 例如：0x42 |
| 寄存器个数高位 | 例如：0x00 |
| 寄存器个数低位 | 例如：0x02 |
| 数据字节数 | 例如：0x04 |
| 写数据高位 | 例如：0x00 |
| ... | ... |
| 写数据低位 | 例如：0xE8 |
| CRC高位 | 例如：0x76 |
| CRC低位 | 例如：0xF8 |

**从机应答命令格式**

| 字段 | 描述 |
| --- | --- |
| 设备站号 | 例如：0x01 |
| 功能码 | 0x10 |
| 第一个寄存器的高位地址 | 例如：0x00 |
| 第一个寄存器的低位地址 | 例如：0x42 |
| 寄存器个数高位 | 例如：0x00 |
| 寄存器个数低位 | 例如：0x02 |
| CRC高位 | 例如：0xE1 |
| CRC低位 | 例如：0xDC |

## Modbus地址列表

| 地址(十进制) | 参数名称 | 说明 | 初始值 | 参数范围 | 只读/读写/可存储 |
| --- | --- | --- | --- | --- | --- |
| 10 | 存储参数 | 0：空闲<br>1：存储参数<br>2：初始化控制参数<br>3：初始化电机参数<br>4：初始化所有参数并保存<br>5：重启 | | | 读写 |
| 30 | 设备温度 | 单位是0.1℃ | | | 只读 |
| 31 | 总线电压 | 直流总线电压，即输入电压，单位是0.1V | | | 只读 |
| 40 | 实时电流 | 驱动器输出的q轴电流，单位是0.001A | | | 只读 |
| 41 | 实时电流 | 驱动器输出的q轴电流，单位是0.001A | | | 只读 |
| 42 | 实际速度 | 电机实时速度，单位0.001转/秒 | | | 只读 |
| 43 | 实际速度 | 电机实时速度，单位0.001转/秒 | | | 只读 |
| 44 | 实际位置 | 电机实际位置，单位count | | | 只读 |
| 45 | 实际位置 | 电机实际位置，单位count | | | 只读 |
| 50 | 错误状态 | Bit1：电流传感器错误<br>Bit3：编码器错误<br>Bit4：霍尔信号错误<br>Bit5：励磁错误<br>Bit6：跟随超差错误<br>Bit8：低压错误<br>Bit9：高压错误<br>Bit10：过温错误<br>Bit11：过流错误<br>Bit12：过载错误 | | | 只读 |
| 51 | 错误状态 | 同上 | | | 只读 |
| 60 | 工作模式 | 0：开环拖动（内部使用）<br>1：带轨迹位置模式<br>2：速度模式<br>3：带轨迹速度模式<br>4：力矩模式<br>7：位置模式 | | | 读写/存储 |
| 62 | 控制字 | 6：松轴<br>F：锁轴<br>86：清错 | | | 读写/存储 |
| 64 | 目标电流 | q轴目标电流，单位0.001A<br>生效工作模式：0、4 | | | 读写/存储 |
| 65 | 目标电流 | 同上 | | | 读写/存储 |
| 66 | 目标速度 | 目标速度，单位0.001转/秒<br>生效工作模式：2、3 | | | 读写/存储 |
| 67 | 目标速度 | 同上 | | | 读写/存储 |
| 68 | 目标位置 | 目标位置，单位count<br>生效工作模式：1、7 | | | 读写/存储 |
| 69 | 目标位置 | 同上 | | | 读写/存储 |
| 74 | 内部电流指令 | 内部q轴电流指令，单位0.001A | | | 只读 |
| 75 | 内部电流指令 | 同上 | | | 只读 |
| 76 | 内部速度指令 | 内部速度指令，单位0.001转/秒 | | | 只读 |
| 77 | 内部速度指令 | 同上 | | | 只读 |
| 78 | 内部位置指令 | 内部位置指令，单位count | | | 只读 |
| 79 | 内部位置指令 | 同上 | | | 只读 |
| 100 | 软件版本 | 转换成十进制一般是日期 | | | 读写/存储 |
| 101 | 软件版本 | 同上 | | | 读写/存储 |
| 120 | 485通讯站号 | 485通讯站号 | | | 读写/存储 |
| 121 | 485寄存器地址偏移 | 485寄存器地址偏移 | | | 读写/存储 |
| 122 | 485通讯波特率 | 485通讯波特率，修改后需保存重启才能生效，默认38400 | | | 读写/存储 |
| 123 | 485通讯波特率 | 同上 | | | 读写/存储 |
| 124 | 485通讯协议 | 485通讯协议<br>1：MODBUS RTU，默认值1 | | | 读写/存储 |
| 178 | 上电使能 | 上电自动使能锁轴<br>0：不生效<br>1：生效，默认值0 | | | 读写/存储 |
| 222 | 轨迹速度 | 轨迹模式运行时的最大速度，单位0.001转/秒<br>生效工作模式：1、3 | | | 读写/存储 |
| 223 | 轨迹速度 | 同上 | | | 读写/存储 |
| 224 | 轨迹加速度 | 轨迹模式运行时的加速度，单位0.001转/秒/秒<br>生效工作模式：1、3 | | | 读写/存储 |
| 225 | 轨迹加速度 | 同上 | | | 读写/存储 |
| 226 | 轨迹减速度 | 轨迹模式运行时的减速度，单位0.001转/秒/秒<br>生效工作模式：1、3 | | | 读写/存储 |
| 227 | 轨迹减速度 | 同上 | | | 读写/存储 |